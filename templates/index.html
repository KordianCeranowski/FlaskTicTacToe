{% extends 'base.html' %}

{% block head %}
{% endblock %}
{% block body %}

<script type="text/javascript">
$(document).ready(() => {

var socket = io.connect(`http://${document.domain}:${location.port}`);

socket.on('connect', function(msg)
{
  socket.emit('player_joined_menu', {})
  console.log('sent player_joined_menu')
})

function update_menu(games)
{
  $(".menu_game_row").remove();
  games.forEach((game) =>
  {
    $('.table').append(
      `<tr class='menu_game_row'>
        <td>${game['rows']} XX ${game['cols']}</td>
        <td>${game['goal']}</td>
        <td>${game['players_joined']}/${game['players_count']}</td>
        <td>${game['round']}</td>
        <td>
          <a href="/game/${game['id']}" class="btn btn-success">Join</a>
          <a game-id=${game['id']} class="btn btn-danger button-remove">Remove</a>
        </td>
      </tr>`)
  })
  $('.button-remove').click(function()
  {
    console.log(`clicked button-remove`)
    socket.emit('deleted_game',
    {
      'id':  $(this).attr('game-id')
    })
    console.log(`sent deleted_game with id:${$(this).attr('game-id')}`);
  })
}

socket.on('update_menu', function(msg)
{
  console.log(`recived update_menu`)
  var games = JSON.parse(msg)['games'];
  console.log(`recived update_menu with ${games}`)
  update_menu(games)
})

$('#button-create').click(function()
{
  console.log('clicked button-create')
  socket.emit('created_game',
  {
    'rows':     $("#rows").val(),
    'cols':     $("#cols").val(),
    'goal':     $("#goal").val(),
    'players_count':  $("#players_count").val()
  })
})

$('#button-set-emoji').click(function()
{
  Cookies.set('emoji', $("#emoji").val())
  $('#your_emoji').empty()
  $('#your_emoji').append($("#emoji").val())
  $("#emoji").val("")
})

if(Cookies.get('session_id') == undefined)
  Cookies.set('session_id', `${parseInt(Math.random()*100000000)}`)
$('#your_emoji').append(Cookies.get('emoji'))

})
</script>

<div class="container">
  <div class="jumbotron">
    <div class="page-header">
      <h1>PicPacPoe üêç &#x1F923;</h1>
    </div>
    <table class="table table-striped">
      <tr>
        <th scope="col">Size</th>
        <th scope="col">Goal</th>
        <th scope="col">Players</th>
        <th scope="col">Round</th>
        <th scope="col">Options</th>
      </tr>
    </table>

    <div class="form-row align-items-center">
      <div class="col-auto">
        <input type="text" class="form-control mb-2" id="rows" placeholder="Rows">
      </div>
      <div class="col-auto">
        <input type="text" class="form-control mb-2" id="cols" placeholder="Columns">
      </div>
      <div class="col-auto">
        <input type="text" class="form-control mb-2" id="goal" placeholder="Goal">
      </div>
      <div class="col-auto">
        <input type="text" class="form-control mb-2" id="players_count" placeholder="Players">
      </div>
      <div class="col-auto">
        <input type='submit' id="button-create" class="btn btn-primary mb-2"></input>
      </div>
    </div>


    Your current emoji: <div id='your_emoji'></div>
    <div class="form-row align-items-center">
      <div class="col-auto">
        <input type="text" class="form-control mb-2" id="emoji" placeholder="Set your custom emoji">
      </div>
      <div class="col-auto">
        <input type='submit' id="button-set-emoji" class="btn btn-primary mb-2"></input>
      </div>
    </div>


  </div>
</div>
{% endblock %}
