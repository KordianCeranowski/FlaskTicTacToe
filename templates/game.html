{% extends 'base.html' %}

{% block head %}

{% endblock %}
{% block body %}

<script type="text/javascript">
  var socket = io.connect(`http://${document.domain}:${location.port}`);

  $(document).ready(() => {

    socket.on('connect', function(msg){
      socket.emit('player_connected', {
        'player_id': Cookies.get('session_id'),
        'game_id': {{ game.id }}
      })
    })

    $('.cell').click(function() {
      var row = $(this).attr('row')
      var col = $(this).attr('col')
      console.log(`row: ${row}, col: ${col}`)
      socket.emit('pressed_cell', {
        'game_id': {{ game.id }},
        'row': `${row}`,
        'col': `${col}`
      })
    })

    socket.on('pressed_cell', function(msg) {
      if(msg['game_id'] == {{ game.id }}) {
        $(`[row=${msg['row']}][col=${msg['col']}]`)
        .replaceWith(`<td class=\'cell_css\'>${msg['sign']}</td>`)

        $('#curr_player').empty()
        $('#curr_player').append(`Current player: ${msg['next_sign']}`)

        $('#curr_round').empty()
        $('#curr_round').append(`Round: ${msg['round']}`)

      }
    })
  })
</script>

<table id=ui class=table-striped>
  <tr>
    <td>Game {{ game.id }}</td>
  </tr>
  <tr>
    <td id='curr_round'>Round {{game.round}}</td>
  </tr>
  <tr>
    <td id='curr_player'>Current player: {{ game.current_player_sign() }}</td>
  </tr>
</table>

<table id=board>
  {% for row in range(game.rows) %}
  <tr>
    {% for col in range(game.cols) %}
    {% if game.get_board()[(row,col)] != '_' %}
      <td class='cell cell_css' row={{row}} col={{col}}>{{ game.get_board()[(row,col)] }}</td>
    {% else %}
      <td class='cell cell_css' row={{row}} col={{col}}></td>
    {% endif %}
    {% endfor %}
  </tr>
  {%endfor %}
</table>

{% endblock %}
